---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r}

# +++++++++++++++++ #
#                   # 
#    LIBRARIES
#                   #
# +++++++++++++++++ #

 
library(readr) #to read csv equipment list and exported data from OneClick
#load these last so their function names don't get overridden:
library(tidyverse) #for everything 
library(dplyr) #for everything 
library(reshape2)

# +++++++++++++++++ #
#                   # 
#READ IN SCRAPED DATA
#                   #
# +++++++++++++++++ #

files.lit <- 
    list.files(path = "RawFiles_do_not_upload/", # read all excel fileNAMES from the folder
                       pattern = "*.csv",
                       full.names = TRUE,
                       recursive = FALSE) %>% 
    tbl_df() %>% # make the list into a dataframe, default name of column is "value"
    rename(Filenames = value)%>%
    mutate(myFiles = purrr::map(Filenames, function(x) {  #for each filename, read in the file (gets nested)
        read_csv(x)})) %>% 
    unnest(myFiles) 

# +++++++++++++++++ #
#                   # 
#ORGANIZE DATA BY KEY
#                   #
# +++++++++++++++++ # 

dat.lit <-
    files.lit %>%
    select(Filenames,Title,Year,Cites) %>%  # parse to only the relevant columns
    filter(Cites>1) %>% # get rid of a uncited papers
    mutate(category = case_when(  #simplify the categories
            Filenames=="RawFiles_do_not_upload/Energy_Buildings_PoPCites.cs" ~ 1,
            Filenames == "RawFiles_do_not_upload/Health_Buildings_PoPCites.csv" ~ 2,
            TRUE ~ 3)) %>%
    select(-Filenames) %>%
    group_by(Title) %>%
    summarize(new_cat = paste(Cateto))
    
       

# quick look at data
  ggplot(dat.lit, aes(x = Year,
                         y= Cites)) + 
    geom_bar( stat = "identity", position = "stack" ) +
    facet_grid(Filenames~.) +
    scale_fill_brewer( palette = "YlGnBu" ) +
    theme_minimal() + theme( legend.position = "bottom" )



```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
